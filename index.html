<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; font-size: 16px; } 
        
        /* ìº˜ë¦°ë” ë ˆì´ì•„ì›ƒ */
        .calendar-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 24px; 
        }
        
        .day-cell { min-height: 80px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; cursor: pointer; border: 1px solid #e5e7eb; }
        .day-cell:hover { background-color: #f0f9ff; border-color: #3b82f6; }
        .booking-info { font-size: 14px; line-height: 1.4; margin-top: 2px; width: 100%; text-align: center; font-weight: 700; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: white; padding: 40px; border-radius: 20px; width: 95%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        
        th, td { padding: 12px 10px; font-size: 15px; white-space: nowrap; }
        .col-comment { max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* ê·¸ë¦¬ë“œ ë·° (ë¬´ê¸°ëª…/ì„ ë¶ˆì œ) í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .grid-view-table th, .grid-view-table td { text-align: center; border: 1px solid #cbd5e1; padding: 8px; font-size: 14px; white-space: nowrap; }
        .grid-view-table th { background-color: #f1f5f9; font-weight: bold; }
        
        #lookupResults table th, #lookupResults table td { border: 1px solid #cbd5e1; padding: 12px; text-align: center; font-size: 16px; white-space: nowrap; }
        #lookupResults table th { background-color: #f8fafc; font-weight: bold; }
        
        input, select { font-size: 16px !important; padding: 10px !important; }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .checkbox-label:hover {
            background-color: #eff6ff;
        }
        .checkbox-input {
            width: 1.2rem;
            height: 1.2rem;
            margin-right: 0.5rem;
            accent-color: #2563eb;
        }

        @keyframes loadingSlide {
            0% { left: -40%; width: 30%; }
            50% { width: 60%; }
            100% { left: 100%; width: 30%; }
        }
        .progress-bar-inner {
            position: absolute;
            top: 0;
            height: 100%;
            background-color: #2563eb; 
            border-radius: 9999px;
            animation: loadingSlide 1.5s infinite ease-in-out;
        }

        /* [ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼] */
        @media (max-width: 640px) {
            body { padding: 0.5rem !important; font-size: 13px !important; }
            .calendar-container { grid-template-columns: 1fr; gap: 12px; }
            .day-cell { min-height: 50px; padding: 2px !important; }
            .booking-info { font-size: 10px; line-height: 1.1; margin-top: 1px; }
            
            th, td { padding: 6px 4px !important; font-size: 12px !important; }
            input, select { font-size: 13px !important; padding: 6px !important; }
            button { padding-top: 6px !important; padding-bottom: 6px !important; font-size: 13px !important; }
            .modal-content { padding: 20px !important; width: 98% !important; }
            
            /* ì²´í¬ë°•ìŠ¤ ë¼ë²¨ íƒ€ì´íŠ¸í•˜ê²Œ */
            .checkbox-label { padding: 0.1rem 0.15rem; font-size: 11px; }
            .checkbox-input { width: 0.9rem; height: 0.9rem; margin-right: 0.15rem; }
            
            nav button { padding: 6px 12px !important; font-size: 13px !important; }
            h1 { font-size: 1.25rem !important; margin-bottom: 0.25rem !important; }
            
            .hidden-mobile { display: none; }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-6">

    <div id="loginScreen" class="flex flex-col items-center justify-center min-h-screen">
        <div class="bg-white rounded-3xl shadow-xl p-6 md:p-10 w-full max-w-md border border-gray-200">
            <h2 class="text-2xl md:text-4xl font-extrabold text-center text-gray-800 mb-6 md:mb-8">ë¡œê·¸ì¸</h2>
            <form id="loginForm" class="space-y-4 md:space-y-6">
                <div>
                    <label for="loginUsername" class="block text-base md:text-lg font-bold text-gray-700 mb-1 md:mb-2">ì•„ì´ë”” (ì´ë¦„)</label>
                    <input type="text" id="loginUsername" required class="block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="loginPassword" class="block text-base md:text-lg font-bold text-gray-700 mb-1 md:mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" required class="block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center pt-2">
                    <input id="rememberMe" type="checkbox" class="h-5 w-5 md:h-6 md:w-6 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer">
                    <label for="rememberMe" class="ml-2 md:ml-3 block text-base md:text-lg text-gray-900 cursor-pointer">ì•„ì´ë”” ì €ì¥</label>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg md:text-xl py-3 md:py-4 px-6 rounded-xl shadow-lg transition hover:scale-[1.02]">ë¡œê·¸ì¸ í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <div class="bg-white rounded-2xl md:rounded-3xl shadow-xl p-3 md:p-10 max-w-[1400px] mx-auto border border-gray-200">
            <header class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-8 gap-3 md:gap-6 border-b pb-3 md:pb-6">
                <div class="text-center md:text-left">
                    <h1 class="text-xl md:text-4xl font-black text-gray-900 tracking-tight">ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
                    <a href="#" id="noticeLink" class="text-xs md:text-lg text-blue-600 hover:text-blue-800 font-semibold inline-block">ì´ìš© ë° ì·¨ì†Œ ì•ˆë‚´ ë³´ê¸°</a>
                </div>
                <div class="flex items-center gap-2 md:gap-4">
                    <button id="openModalBtn" class="bg-blue-600 hover:bg-blue-700 text-white text-sm md:text-lg font-bold py-2 px-4 md:py-3 md:px-8 rounded-full shadow-md transition-all flex items-center gap-1 md:gap-2 whitespace-nowrap">
                        <span class="text-lg md:text-2xl">+</span> ì˜ˆì•½ ì‹ ì²­
                    </button>
                    <button id="logoutBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm md:text-lg font-bold py-2 px-3 md:py-3 md:px-6 rounded-full transition-colors whitespace-nowrap">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <div class="flex flex-wrap items-center gap-2 md:gap-4 mb-4 md:mb-8 p-3 md:p-6 bg-blue-50 rounded-xl md:rounded-2xl border border-blue-200 shadow-inner">
                <div class="flex items-center gap-2 md:gap-3 w-full md:w-auto">
                    <label class="text-sm md:text-lg font-bold text-blue-900 whitespace-nowrap">ê¸°ê°„:</label>
                    <select id="globalPeriodSelector" class="border-2 border-blue-300 rounded-lg bg-white text-gray-800 font-bold focus:ring-2 focus:ring-blue-500 outline-none w-full md:min-w-[280px] cursor-pointer shadow-sm text-sm"></select>
                </div>
            </div>

            <div class="mb-4 md:mb-6 overflow-x-auto">
                <nav class="flex space-x-2 md:space-x-4 pb-1" aria-label="Tabs">
                    <button id="calendarTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-blue-600 text-white whitespace-nowrap">ìº˜ë¦°ë”</button>
                    <button id="statusTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-white text-gray-600 border hover:bg-gray-50 whitespace-nowrap">ì˜ˆì•½ í˜„í™©</button>
                    <button id="entertainmentTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-white text-gray-600 border hover:bg-gray-50 whitespace-nowrap">ì ‘ëŒ€ë¹„ ì°¨ê°</button>
                    <button id="lookupTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-white text-gray-600 border hover:bg-gray-50 hidden whitespace-nowrap">ì¡°íšŒ</button>
                    <button id="anonymousTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-white text-gray-600 border hover:bg-gray-50 hidden whitespace-nowrap">ë¬´ê¸°ëª…</button>
                    <!-- ì„ ë¶ˆì œ íƒ­ ë²„íŠ¼ -->
                    <button id="prepaidTabBtn" class="px-3 py-2 md:px-6 md:py-3 font-bold text-sm md:text-lg rounded-xl transition-all shadow-sm bg-white text-gray-600 border hover:bg-gray-50 hidden whitespace-nowrap">ì„ ë¶ˆì œ</button>
                </nav>
            </div>

            <div id="calendarView" class="tab-content">
                <!-- ìº˜ë¦°ë” í•„í„° ì˜ì—­ -->
                <div class="bg-gray-50 p-2 md:p-4 rounded-xl border border-gray-200 mb-3 md:mb-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-2 md:gap-4">
                    <div class="flex flex-wrap gap-0.5 md:gap-2 items-center">
                        <span class="font-bold text-gray-700 mr-0.5 md:mr-2 text-[11px] md:text-base whitespace-nowrap">ê³¨í”„ì¥:</span>
                        <!-- ëª¨ë°”ì¼ ë°˜ì‘í˜•: md:hidden(ì•½ì¹­), hidden md:inline(ì „ì²´) -->
                        <label class="checkbox-label"><input type="checkbox" name="calCourseFilter" value="ë ˆì´í¬ìš°ë“œ" checked class="checkbox-input"><span class="md:hidden">ë ˆì´í¬</span><span class="hidden md:inline">ë ˆì´í¬ìš°ë“œ</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="calCourseFilter" value="ìŠ¤ì¹´ì´ë°¸ë¦¬" checked class="checkbox-input"><span class="md:hidden">ìŠ¤ì¹´ì´</span><span class="hidden md:inline">ìŠ¤ì¹´ì´ë°¸ë¦¬</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="calCourseFilter" value="íë“œë¡œì‚¬ì´" checked class="checkbox-input"><span class="md:hidden">íë“œë¡œ</span><span class="hidden md:inline">íë“œë¡œì‚¬ì´</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="calCourseFilter" value="ë²¨ë£¨í† " checked class="checkbox-input">ë²¨ë£¨í† </label>
                    </div>
                    <div class="flex items-center gap-2 w-full md:w-auto justify-between md:justify-end">
                        <div id="calendarNameFilterWrapper" class="hidden flex items-center gap-1 md:gap-2">
                             <label class="font-bold text-gray-700 text-xs md:text-base">ì´ë¦„:</label>
                             <select id="calendarNameSelect" class="border border-gray-300 rounded-lg p-1 md:p-2 text-xs md:text-sm min-w-[80px] md:min-w-[120px]"></select>
                        </div>
                        <label class="flex items-center cursor-pointer font-bold text-blue-800 bg-blue-100 px-2 py-1 md:px-4 md:py-2 rounded-lg hover:bg-blue-200 transition text-xs md:text-base">
                            <input type="checkbox" id="calMyBookingFilter" class="w-4 h-4 md:w-5 md:h-5 mr-1 md:mr-2 accent-blue-600">
                            ë‚´ ì˜ˆì•½ë§Œ
                        </label>
                    </div>
                </div>
                <div id="calendar" class="calendar-container"></div>
            </div>

            <div id="statusView" class="tab-content hidden">
                 <!-- ìƒíƒœ ë° ê´€ë¦¬ì í•„í„° ì˜ì—­ -->
                 <div class="bg-gray-50 p-2 md:p-4 rounded-xl border border-gray-200 mb-3 md:mb-6 flex flex-col lg:flex-row gap-2 md:gap-4 items-start lg:items-center justify-between">
                    <div class="flex flex-wrap gap-1 md:gap-4 items-center">
                        <span class="font-bold text-gray-700 mr-1 md:mr-2 text-xs md:text-base">ìƒíƒœ:</span>
                        <label class="checkbox-label"><input type="checkbox" name="statusFilter" value="ì „ì²´" checked class="checkbox-input">ì „ì²´</label>
                        <label class="checkbox-label"><input type="checkbox" name="statusFilter" value="ì˜ˆì•½ì™„ë£Œ" class="checkbox-input">ì™„ë£Œ</label>
                        <label class="checkbox-label"><input type="checkbox" name="statusFilter" value="ì˜ˆì•½ì¤‘" class="checkbox-input">ì˜ˆì•½ì¤‘</label>
                        <label class="checkbox-label"><input type="checkbox" name="statusFilter" value="ì·¨ì†Œ" class="checkbox-input">ì·¨ì†Œ</label>
                    </div>
                    <!-- ê´€ë¦¬ììš© í•„í„° ê·¸ë£¹ -->
                     <div class="flex flex-wrap gap-2 items-center justify-end w-full lg:w-auto">
                        <div id="statusCourseFilterWrapper" class="hidden flex items-center gap-1 md:gap-2">
                            <label class="font-bold text-gray-700 text-xs md:text-base">ê³¨í”„ì¥:</label>
                            <select id="statusCourseSelect" class="border border-gray-300 rounded-lg p-1 md:p-2 text-xs md:text-sm min-w-[80px] md:min-w-[120px]"></select>
                        </div>
                        <div id="statusNameFilterWrapper" class="hidden flex items-center gap-1 md:gap-2">
                             <label class="font-bold text-gray-700 text-xs md:text-base">ì´ë¦„:</label>
                             <select id="statusNameSelect" class="border border-gray-300 rounded-lg p-1 md:p-2 text-xs md:text-sm min-w-[80px] md:min-w-[120px]"></select>
                         </div>
                     </div>
                 </div>

                 <div class="flex justify-end items-center mb-3 md:mb-6 gap-2 md:gap-4">
                    <div class="flex gap-2 md:gap-3">
                        <div id="adminOnlyControls" class="flex gap-2 md:gap-3 hidden">
                            <button id="downloadExcelBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 md:py-2 md:px-5 rounded-lg text-xs md:text-base shadow-sm whitespace-nowrap">ì—‘ì…€ ë‹¤ìš´</button>
                            <button id="uploadExcelBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 md:py-2 md:px-5 rounded-lg text-xs md:text-base shadow-sm whitespace-nowrap">ì—‘ì…€ ì—…ë¡œë“œ</button>
                        </div>
                        <button id="cancelSelectedBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 md:py-2 md:px-5 rounded-lg text-xs md:text-base shadow-sm hidden whitespace-nowrap">ì„ íƒ ì·¨ì†Œ</button>
                        <!-- ê´€ë¦¬ììš© ì‚­ì œ ë²„íŠ¼ -->
                        <button id="deleteSelectedBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 md:py-2 md:px-5 rounded-lg text-xs md:text-base shadow-sm hidden whitespace-nowrap">ì‚­ì œ</button>
                    </div>
                </div>
                
                <div class="overflow-x-auto rounded-xl border border-gray-300 shadow-sm">
                    <table class="min-w-full bg-white">
                        <thead id="statusTableHead" class="bg-gray-100 text-gray-800 uppercase text-xs md:text-sm font-extrabold border-b border-gray-300">
                            <tr>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left"><input type="checkbox" id="selectAllStatus" class="w-4 h-4 md:w-5 md:h-5 accent-blue-600"></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer" data-sort="Golf Course">ê³¨í”„ì¥ <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer" data-sort="Name">ì„±ëª… <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer" data-sort="Date">ë‚ ì§œ <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-center cursor-pointer" data-sort="Team">íŒ€ <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer" data-sort="Time">ì‹œê°„ <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer" data-sort="Status">ìƒíƒœ <span class="sort-indicator"></span></th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left cursor-pointer">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody id="statusTableBody" class="text-gray-700 text-xs md:text-base"></tbody>
                    </table>
                </div>
            </div>

            <div id="entertainmentView" class="tab-content hidden">
                <div class="mb-4 md:mb-8 p-4 md:p-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl md:rounded-2xl border border-blue-200 shadow-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8 items-end">
                        <div>
                            <h3 class="text-sm md:text-base font-bold text-gray-600 mb-1 md:mb-2">ì ‘ëŒ€ë¹„ í•©ê³„</h3>
                            <p id="totalEntertainmentCost" class="text-2xl md:text-3xl font-black text-blue-800">â‚©0</p>
                        </div>
                        <div>
                            <h3 class="text-sm md:text-base font-bold text-gray-600 mb-1 md:mb-2">ì”ì—¬ ì°¨ê°ì•¡</h3>
                            <p id="remainingEntertainmentCost" class="text-2xl md:text-3xl font-black text-green-700">â‚©0</p>
                        </div>
                        <div class="space-y-2 md:space-y-3">
                            <input type="text" id="commonEntertainment" class="block w-full border-gray-300 rounded-lg shadow-sm text-sm" placeholder="ê³µí†µì ‘ëŒ€ë¹„ ì…ë ¥">
                            <input type="text" id="personalEntertainment" class="block w-full border-gray-300 rounded-lg shadow-sm text-sm" placeholder="ê°œì¸ì ‘ëŒ€ë¹„ ì…ë ¥">
                        </div>
                        <button id="saveEntertainmentBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 md:py-3 md:px-6 rounded-xl shadow-lg transition-transform hover:scale-105 whitespace-nowrap text-sm md:text-base">ì„¤ì • ì €ì¥</button>
                    </div>
                </div>
                <div id="adminEntertainmentFilter" class="mb-3 md:mb-6 hidden items-center gap-2 md:gap-3">
                    <label class="text-sm md:text-lg font-bold text-gray-800">ëŒ€ìƒì(ì´ë¦„):</label>
                    <select id="entertainmentNameFilter" class="border-gray-300 rounded-lg shadow-sm bg-white min-w-[120px] md:min-w-[150px] text-sm"></select>
                </div>
                <div class="overflow-x-auto rounded-xl border border-gray-300 shadow-sm">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-100 text-gray-800 uppercase text-xs md:text-sm font-extrabold">
                            <tr>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left">ê³¨í”„ì¥</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left">ì„±ëª…</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left">ë‚ ì§œ</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-center">íŒ€</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left">ì‹œê°„</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-left">ìƒíƒœ</th>
                                <th class="py-2 px-2 md:py-4 md:px-4 text-right">ì ‘ëŒ€ë¹„</th>
                            </tr>
                        </thead>
                        <tbody id="entertainmentTableBody" class="text-gray-700 text-xs md:text-base"></tbody>
                    </table>
                </div>
            </div>

            <div id="lookupView" class="tab-content hidden">
                <div class="bg-gray-50 p-4 md:p-8 rounded-xl md:rounded-2xl border border-gray-200 mb-4 md:mb-8 flex flex-wrap gap-4 md:gap-6 items-center shadow-sm">
                    <div class="flex items-center gap-2 md:gap-3">
                        <label class="text-sm md:text-lg font-bold text-gray-700">ì„±ëª…:</label>
                        <input type="text" id="lookupName" class="border-gray-300 rounded-lg shadow-sm w-32 md:w-40 text-sm">
                    </div>
                    <div class="flex items-center gap-2 md:gap-3">
                        <label class="text-sm md:text-lg font-bold text-gray-700">ì¡°íšŒì¼ì:</label>
                        <input type="date" id="lookupDate" class="border-gray-300 rounded-lg shadow-sm text-sm">
                    </div>
                    <button id="lookupBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 md:py-3 md:px-8 rounded-xl shadow-md text-sm md:text-lg whitespace-nowrap">ë°ì´í„° ì¡°íšŒ</button>
                </div>
                <div id="lookupResults" class="space-y-4 md:space-y-8"></div>
            </div>

            <div id="anonymousView" class="tab-content hidden">
                <div id="anonymousTableContainer" class="overflow-x-auto rounded-xl border border-gray-300 shadow-sm"></div>
            </div>

            <!-- ì„ ë¶ˆì œ íƒ­ ì»¨í…Œì´ë„ˆ -->
            <div id="prepaidView" class="tab-content hidden">
                <div id="prepaidTableContainer" class="overflow-x-auto rounded-xl border border-gray-300 shadow-sm"></div>
            </div>
        </div>
    </div>

    <div id="bookingModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modalTitle" class="text-2xl md:text-3xl font-extrabold mb-4 md:mb-8 text-gray-800 border-b pb-2 md:pb-4">ì˜ˆì•½ ì‹ ì²­</h2>
            <form id="bookingForm" class="space-y-3 md:space-y-6">
                <input type="hidden" id="bookingId">
                <div class="grid grid-cols-2 gap-3 md:gap-6">
                    <div class="col-span-2">
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">ì‹ ì²­ì¸</label>
                        <input type="text" id="userName" required class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">ì˜ˆì•½ë‚ ì§œ (ì—°ë„4ìë¦¬)</label>
                        <input type="date" id="bookingDate" required max="9999-12-31" class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">ê³¨í”„ì¥</label>
                        <select id="golfCourse" required class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white"></select>
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">íŒ€ ìˆ˜</label>
                        <input type="number" id="numberOfTeams" min="1" required class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">í‹°ì˜¤í”„ ì‹œê°„</label>
                        <input type="time" id="bookingTime" class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">ìƒíƒœ</label>
                        <input type="text" id="bookingStatus" class="block w-full border-gray-300 rounded-lg shadow-sm bg-gray-50">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs md:text-sm font-bold text-gray-600 mb-1">ë¹„ê³ </label>
                        <input type="text" id="notes" class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <div class="flex justify-end space-x-2 md:space-x-4 pt-4 md:pt-8 border-t">
                    <button type="button" id="closeModalBtn" class="px-4 py-2 md:px-8 md:py-3 rounded-xl border-2 border-gray-300 font-bold text-gray-600 hover:bg-gray-100 text-sm md:text-lg transition-colors whitespace-nowrap">ë‹«ê¸°</button>
                    <button type="submit" class="px-4 py-2 md:px-8 md:py-3 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 text-sm md:text-lg shadow-md transition-colors whitespace-nowrap">ì €ì¥í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Notice Modal -->
    <div id="noticeModal" class="modal-overlay">
        <div class="modal-content relative max-w-3xl max-h-[80vh] overflow-y-auto">
            <button id="closeNoticeBtn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
            <h2 class="text-xl md:text-2xl font-bold mb-2 text-center text-gray-800">ê³¨í”„ì˜ˆì•½ì‹œìŠ¤í…œ ì•ˆë‚´</h2>
            <p class="text-xs md:text-sm text-center text-gray-500 mb-4 md:mb-6">[2026.01ì›”, ì¸ì‚¬ì´ë¬´íŒ€]</p>
            <div class="prose max-w-none text-gray-700 space-y-3 md:space-y-4 text-sm md:text-base">
                <div>
                    <h3 class="text-base md:text-lg font-bold">ì‹ ì²­ê°€ëŠ¥ ê³¨í”„íšŒì›ê¶Œ í˜„í™©</h3>
                    <div class="pl-2 md:pl-4 mt-1 md:mt-2 space-y-2 md:space-y-3">
                        <div>
                            <h4 class="font-semibold">1. ë¬´ê¸°ëª…íšŒì›ê¶Œ</h4>
                            <p class="text-xs md:text-sm">ì´ìš©ë°©ì‹ : ê° ë²•ì¸ ë°°ì • íšŸìˆ˜ ë‚´ ë¬´ê¸°ëª… ì‚¬ìš© (1íŒ€ íšŒì›ê°€ ì ìš©)</p>
                            <ul class="list-disc list-inside text-xs md:text-sm space-y-1 mt-1">
                                <li><strong>ğŸ“ ë ˆì´í¬ìš°ë“œCC</strong>
                                    <ul class="list-['-_'] list-inside ml-2 md:ml-4">
                                        <li>ì›” ì´ìš©íšŸìˆ˜ : ì£¼ì¤‘ 9íšŒ, ì£¼ë§ 6íšŒ</li>
                                        <li>ë°°ì •ëŒ€ìƒ : ì£¼ì¤‘(êµ­ë‚´ì˜ì—…íŒ€ ë“± 9ê°œíŒ€), ì£¼ë§(êµ­ë‚´ì˜ì—…ë‹´ë‹¹ì„ì› ë“± 6ëª…)</li>
                                    </ul>
                                </li>
                                <li><strong>ğŸ“ ì‹œì—ë‚˜ ë²¨ë£¨í† CC</strong>
                                    <ul class="list-['-_'] list-inside ml-2 md:ml-4">
                                        <li>ì›” ì´ìš©íšŸìˆ˜ : ì£¼ì¤‘ 5íšŒ, ì£¼ë§ 3íšŒ</li>
                                        <li>ëŒ€ì²´ ì´ìš© : ìŠ¤ì¹´ì´ë°¸ë¦¬ 1íšŒ ëŒ€ì²´ ì‚¬ìš© ê°€ëŠ¥</li>
                                        <li>ë°°ì •í˜„í™© : ê¸°ëª…íšŒì›ê¶Œ ë¯¸ë³´ìœ  ì •íšŒì› ë“± (ë°°ì • í›„ ì”ì—¬í‹° êµ­ë‚´ì˜ì—…íŒ€ ë“± ì‚¬ìš© ê°€ëŠ¥)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold">2. ì„ ë¶ˆì œíšŒì›ê¶Œ</h4>
                            <ul class="list-disc list-inside text-xs md:text-sm space-y-1 mt-1">
                                <li><strong>ëŒ€ìƒ ê³¨í”„ì¥</strong> : ìŠ¤ì¹´ì´ë°¸ë¦¬CC, íë“œë¡œì‚¬ì´CC</li>
                                <li><strong>ë°°ì •ëŒ€ìƒ</strong> : êµ­ë‚´ì˜ì—…íŒ€ ë° ë‹´ë‹¹ì„ì› êµ¬ì¥ë³„ ì›” 1íšŒ</li>
                                <li><strong>ë¹„ìš© êµ¬ì¡°</strong> : ì´ ë¹„ìš© 80ë§Œì›/íŒ€ (ì„ ë¶ˆê¸ˆì—ì„œ ì°¨ê°)</li>
                                <li><strong>ì§€ì› ë‚´ì—­</strong> : ì¸ì‚¬ì´ë¬´íŒ€ ì§€ì›(50ë§Œì›), ê°œì¸/ê³µí†µì ‘ëŒ€ë¹„(30ë§Œì›)</li>
                                <li><strong>ì ìš©ê°€ê²©</strong> : ì¼ë°˜ ì¸í„°ë„·íšŒì›ê°€ (íšŒì›íŠ¹ê°€ ì—†ìŒ)</li>
                                <li><strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong> : ë°˜ê¸°ë§(6ì›”/12ì›”) ì¸ì‚¬ì´ë¬´íŒ€ì—ì„œ ì ‘ëŒ€ë¹„ ì¼ê´„ ì°¨ê°. ì ‘ëŒ€ë¹„ ì‚¬ìš©ì‹œ ì°¨ê° ê¸ˆì•¡ì„ ë¯¸ë¦¬ ê³ ë ¤í•˜ì—¬ ì‚¬ìš© í•„ìš”</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-base md:text-lg font-bold">ğŸ¯ ê³¨í”„ì¥ ì˜ˆì•½ë°©ë²•</h3>
                    <ul class="list-disc list-inside text-xs md:text-sm space-y-1 mt-1 md:mt-2">
                        <li><strong>ë¬´ê¸°ëª…/ì„ ë¶ˆì œíšŒì›ê¶Œ</strong>: ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œì„ í†µí•œ ì˜ˆì•½</li>
                        <li><strong>ì˜¤í”ˆ ìˆœì„œ</strong> : ì„ì› â†’ êµ­ë‚´ì˜ì—…íŒ€ 9ê°œíŒ€ â†’ êµ­ë‚´ì˜ì—… ì™¸ íŒ€ (ì˜¤í”ˆ ì£¼ê¸°: ë°˜ê¸°ì´ˆë§ˆë‹¤)</li>
                        <li><strong>ê¸°íƒ€ ì˜ˆì•½</strong> : ì›” íšŸìˆ˜ ë¯¸ë°°ì • ë˜ëŠ” ëŒ€ì¤‘ ì˜¤í”ˆ ì˜ˆì•½ì¼ ì´ìš© í¬ë§ì‹œ ë‹´ë‹¹ì(ì‹ ì„ì¤‘ ê³¼ì¥)ì—ê²Œ ì—°ë½</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-base md:text-lg font-bold">âŒ ì˜ˆì•½ì·¨ì†Œ</h3>
                     <ul class="list-disc list-inside text-xs md:text-sm space-y-1 mt-1 md:mt-2">
                        <li><strong>ì¼ë°˜ ì·¨ì†Œ</strong>: ì‹œìŠ¤í…œ ì·¨ì†ŒëŠ” í‹°ì˜¤í”„ì¼ 8ì¼ ì „ê¹Œì§€ ê°€ëŠ¥ (ê³¨í”„ì¥ë³„ ì·¨ì†Œê¸°ì¤€ ìƒì´)</li>
                        <li><strong>ìš°ì²œì·¨ì†Œ</strong>: ê³¨í”„ì¥ ê¸°ì¤€ì— ë”°ë¼ ê°€ëŠ¥, ë‹¹ì¼ ê³¨í”„ì¥ì— ì§ì ‘ ì—°ë½ í›„ ì·¨ì†Œ ì§„í–‰</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-base md:text-lg font-bold">â° í‹°ì˜¤í”„ ë‹¹ì¼ ì•ˆë‚´</h3>
                    <ul class="list-disc list-inside text-xs md:text-sm space-y-1 mt-1 md:mt-2">
                        <li><strong>ì²´í¬ì¸</strong>: í‹°ì˜¤í”„ ì‹œê°„ 30ë¶„ ì „ ì²´í¬ì¸ ì™„ë£Œ</li>
                        <li><strong>íŠ¹ì´ì‚¬í•­ í†µë³´</strong>: í‹°ì˜¤í”„ í›„ íŠ¹ì´ì‚¬í•­ ë°œìƒì‹œ ë‹¹ì¼ ë˜ëŠ” ìµì˜ì—…ì¼ì— ë‹´ë‹¹ì(ì‹ ì„ì¤‘ ê³¼ì¥)ì—ê²Œ ë©”ëª¨ ì „ë‹¬</li>
                        <li><strong>ìš°ì²œìœ¼ë¡œ ì¸í•œ ì·¨ì†Œ</strong>: í™€ì•„ì›ƒ ë“±ìœ¼ë¡œ ì¸í•œ ì°¨ê°ê¸ˆì•¡ ìƒì´ ë“±</li>
                    </ul>
                </div>
                 <div>
                    <h3 class="text-base md:text-lg font-bold">ğŸ“ ë¬¸ì˜ì‚¬í•­</h3>
                     <p class="text-xs md:text-sm mt-1 md:mt-2">ì‹ ì„ì¤‘ ê³¼ì¥ (ì¸ì‚¬ì´ë¬´íŒ€)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="modal-overlay">
        <div class="modal-content max-w-sm text-center">
            <h3 class="text-lg md:text-xl font-bold mb-3 md:mb-4 text-gray-800">ì•Œë¦¼</h3>
            <p id="alertMessage" class="text-gray-600 mb-4 md:mb-6 whitespace-pre-wrap font-medium text-sm md:text-base"></p>
            <button id="closeAlertBtn" class="bg-blue-600 text-white px-6 py-2 md:px-8 rounded-lg font-bold hover:bg-blue-700 transition text-sm md:text-base">í™•ì¸</button>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content max-w-sm text-center">
            <h3 class="text-lg md:text-xl font-bold mb-3 md:mb-4 text-gray-800">í™•ì¸</h3>
            <p id="confirmMessage" class="text-gray-600 mb-4 md:mb-6 whitespace-pre-wrap font-medium text-sm md:text-base"></p>
            <div class="flex justify-center gap-3 md:gap-4">
                <button id="confirmCancelBtn" class="border border-gray-300 text-gray-600 px-4 py-2 md:px-6 rounded-lg font-bold hover:bg-gray-50 transition text-sm md:text-base">ì·¨ì†Œ</button>
                <button id="confirmOkBtn" class="bg-blue-600 text-white px-4 py-2 md:px-6 rounded-lg font-bold hover:bg-blue-700 transition text-sm md:text-base">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="uploadModal" class="modal-overlay">
         <div class="modal-content">
            <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-8">ë°ì´í„° ì—…ë¡œë“œ (.csv)</h2>
            <form id="uploadForm" class="space-y-4 md:space-y-6">
                <input type="file" id="excelFile" accept=".csv" required class="block w-full text-sm md:text-base text-gray-500 file:mr-3 md:file:mr-6 file:py-2 md:file:py-3 file:px-4 md:file:px-6 file:rounded-full file:border-0 file:text-sm md:file:text-base file:font-bold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                <div class="flex justify-end space-x-2 md:space-x-4 pt-4 md:pt-6 border-t">
                    <button type="button" id="closeUploadModalBtn" class="px-4 py-2 md:px-8 md:py-3 border-2 rounded-xl font-bold text-sm md:text-lg hover:bg-gray-50 whitespace-nowrap">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 md:px-8 md:py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 text-sm md:text-lg shadow-md whitespace-nowrap">ì—…ë¡œë“œ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="loadingOverlay" class="modal-overlay" style="display: none;">
        <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl w-full max-w-md text-center border border-gray-100">
            <h3 id="loadingText" class="text-xl md:text-2xl font-black text-gray-800 mb-4 md:mb-8 tracking-tight">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</h3>
            <div class="w-full bg-gray-100 rounded-full h-4 md:h-6 overflow-hidden relative shadow-inner">
                <div class="progress-bar-inner"></div>
            </div>
            <p class="mt-2 md:mt-4 text-gray-500 text-xs md:text-sm font-bold animate-pulse">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        </div>
    </div>

    <script>
        // ##### ì„¤ì • (Configuration) #####
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby-xf0NKlY0LHjCA-cPL3iq243XzgoIJ87vtvhlEfxj1zRnei7tXZFGwN9f9cQ4nhMu/exec';
        
        const CALENDAR_GOLF_COURSES = ['ë ˆì´í¬ìš°ë“œ', 'ìŠ¤ì¹´ì´ë°¸ë¦¬', 'ë²¨ë£¨í† ', 'íë“œë¡œì‚¬ì´'];
        const MODAL_GOLF_COURSES = ['ë ˆì´í¬ìš°ë“œ', 'ìŠ¤ì¹´ì´ë°¸ë¦¬', 'ë²¨ë£¨í† ', 'íë“œë¡œì‚¬ì´'];

        const GOLF_COURSE_COLORS = {
            'ë ˆì´í¬ìš°ë“œ': 'text-black',
            'ìŠ¤ì¹´ì´ë°¸ë¦¬': 'text-blue-600',
            'ë²¨ë£¨í† ': 'text-green-600',
            'íë“œë¡œì‚¬ì´': 'text-red-600'
        };

        // ìº˜ë¦°ë” í‘œì‹œ ìˆœì„œ ì •ì˜
        const COURSE_PRIORITY = { 'ë ˆì´í¬ìš°ë“œ': 1, 'ìŠ¤ì¹´ì´ë°¸ë¦¬': 2, 'íë“œë¡œì‚¬ì´': 3, 'ë²¨ë£¨í† ': 4 };

        const COURSE_ABBR = {
            'ë ˆì´í¬ìš°ë“œ': 'ë ˆì´í¬',
            'ìŠ¤ì¹´ì´ë°¸ë¦¬': 'ìŠ¤ì¹´ì´',
            'ë²¨ë£¨í† ': 'ë²¨ë£¨í† ',
            'íë“œë¡œì‚¬ì´': 'íë“œë¡œ'
        };

        const holidays = {
            '2024-01-01': 'ì‹ ì •', '2024-02-09': 'ì„¤ë‚ ', '2024-02-10': 'ì„¤ë‚ ', '2024-02-11': 'ì„¤ë‚ ', '2024-02-12': 'ì„¤ë‚  ëŒ€ì²´ê³µíœ´ì¼', '2024-03-01': 'ì‚¼ì¼ì ˆ', '2024-04-10': 'êµ­íšŒì˜ì› ì„ ê±°', '2024-05-01': 'ê·¼ë¡œìì˜ ë‚ ', '2024-05-05': 'ì–´ë¦°ì´ë‚ ', '2024-05-06': 'ì–´ë¦°ì´ë‚  ëŒ€ì²´ê³µíœ´ì¼', '2024-05-15': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ', '2024-06-06': 'í˜„ì¶©ì¼', '2024-08-15': 'ê´‘ë³µì ˆ', '2024-09-16': 'ì¶”ì„', '2024-09-17': 'ì¶”ì„', '2024-09-18': 'ì¶”ì„', '2024-10-03': 'ê°œì²œì ˆ', '2024-10-09': 'í•œê¸€ë‚ ', '2024-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
            '2025-01-01': 'ì‹ ì •', '2025-01-28': 'ì„¤ë‚ ', '2025-01-29': 'ì„¤ë‚ ', '2025-01-30': 'ì„¤ë‚ ', '2025-03-01': 'ì‚¼ì¼ì ˆ', '2025-05-01': 'ê·¼ë¡œìì˜ ë‚ ', '2025-05-05': 'ì–´ë¦°ì´ë‚ ', '2025-05-06': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ', '2025-06-06': 'í˜„ì¶©ì¼', '2025-08-15': 'ê´‘ë³µì ˆ', '2025-10-03': 'ê°œì²œì ˆ', '2025-10-06': 'ì¶”ì„', '2025-10-07': 'ì¶”ì„', '2025-10-08': 'ì¶”ì„', '2025-10-09': 'í•œê¸€ë‚ ', '2025-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
            '2026-01-01': 'ì‹ ì •', '2026-02-16': 'ì„¤ë‚ ', '2026-02-17': 'ì„¤ë‚ ', '2026-02-18': 'ì„¤ë‚ ', '2026-03-01': 'ì‚¼ì¼ì ˆ', '2026-05-01': 'ê·¼ë¡œìì˜ ë‚ ', '2026-05-05': 'ì–´ë¦°ì´ë‚ ', '2026-05-24': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ', '2026-06-06': 'í˜„ì¶©ì¼', '2026-08-15': 'ê´‘ë³µì ˆ', '2026-09-24': 'ì¶”ì„', '2026-09-25': 'ì¶”ì„', '2026-09-26': 'ì¶”ì„', '2026-10-03': 'ê°œì²œì ˆ', '2026-10-09': 'í•œê¸€ë‚ ', '2026-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
        };
        
        const VALID_STATUSES = ['ì˜ˆì•½ì™„ë£Œ', 'ì˜ˆì•½ì¤‘', 'ì·¨ì†Œì¤‘'];
        const IS_VALID_FOR_COUNTING = (b) => b.MP != 0 && VALID_STATUSES.includes(b.Status);
        const isWeekendBooking = (booking) => booking['WE'] === 'ì£¼ ë§';

        let currentUser = null;
        let bookings = [];
        let userQuotas = {};
        let users = [];
        let allEntertainmentLogs = [];
        
        let selectedYear = new Date().getFullYear();
        let selectedHalf = new Date().getMonth() < 6 ? '1' : '2';
        
        let calendarMyBookingFilter = false;
        
        let calendarNameFilter = 'ì „ì²´';
        let statusNameFilter = 'ì „ì²´';
        let statusCourseFilter = 'ì „ì²´';

        let sortColumn = 'Date';
        let sortDirection = 'asc';
        let entertainmentSortColumn = 'Date';
        let entertainmentSortDirection = 'asc';
        let entertainmentSelectedName = 'ì „ì²´';

        let confirmCallback = null;

        function isInSelectedPeriod(dateStr) {
            if (!dateStr) return false;
            const cleanDateStr = String(dateStr).replace(/\./g, '-').substring(0, 10);
            const date = new Date(cleanDateStr);
            if (isNaN(date.getTime())) return false;
            const year = date.getFullYear();
            const month = date.getMonth(); 
            if (year !== parseInt(selectedYear)) return false;
            if (selectedHalf === '1') return month >= 0 && month <= 5;
            return month >= 6 && month <= 11;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const globalPeriodSelector = document.getElementById('globalPeriodSelector');
            
            let periodOptions = '';
            for(let y=2024; y<=2027; y++) {
                periodOptions += `<option value="${y}-1">${y}ë…„ ìƒë°˜ê¸° (1ì›”~6ì›”)</option>`;
                periodOptions += `<option value="${y}-2">${y}ë…„ í•˜ë°˜ê¸° (7ì›”~12ì›”)</option>`;
            }
            globalPeriodSelector.innerHTML = periodOptions;
            globalPeriodSelector.value = `${selectedYear}-${selectedHalf}`;

            globalPeriodSelector.addEventListener('change', (e) => {
                const parts = e.target.value.split('-');
                selectedYear = parseInt(parts[0]);
                selectedHalf = parts[1];
                renderApp();
            });

            setupCheckboxLogic('calCourseFilter', renderCalendar);
            setupCheckboxLogic('statusFilter', renderStatus);

            document.getElementById('calMyBookingFilter').addEventListener('change', (e) => {
                calendarMyBookingFilter = e.target.checked;
                renderCalendar();
            });

            document.getElementById('bookingDate').addEventListener('change', (e) => {
                const val = e.target.value;
                const bookingId = document.getElementById('bookingId').value;
                if(val >= '2026-07-01') {
                    showAlert("í•˜ë°˜ê¸° ì˜ˆì•½ì€ ì•„ì§ ì˜¤í”ˆë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                    e.target.value = '';
                } else {
                    updateAvailableGolfCourses(val, bookingId);
                }
            });

            showLoading(true, "ì‹œìŠ¤í…œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...");
            try {
                await fetchInitialData();
                initializeLoginState();
            } catch (error) {
                console.error(error);
                showAlert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
            } finally {
                showLoading(false);
            }
            
            setupEventListeners();
        });

        // ########## Functions ##########

        function showAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertModal').style.display = 'flex';
        }

        function showConfirm(msg, callback) {
            document.getElementById('confirmMessage').textContent = msg;
            document.getElementById('confirmModal').style.display = 'flex';
            confirmCallback = callback;
        }

        function setupCheckboxLogic(name, renderFunc) {
            const inputs = document.querySelectorAll(`input[name="${name}"]`);
            inputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    const val = e.target.value;
                    const isChecked = e.target.checked;
                    if (val === 'ì „ì²´') {
                        if (isChecked) {
                            inputs.forEach(i => { if(i.value !== 'ì „ì²´') i.checked = false; });
                        }
                    } else {
                        if (isChecked) {
                            const allInput = document.querySelector(`input[name="${name}"][value="ì „ì²´"]`);
                            if(allInput) allInput.checked = false;
                        } else {
                            const anyChecked = Array.from(inputs).some(i => i.value !== 'ì „ì²´' && i.checked);
                            if (!anyChecked) {
                                const allInput = document.querySelector(`input[name="${name}"][value="ì „ì²´"]`);
                                if(allInput) allInput.checked = true;
                            }
                        }
                    }
                    renderFunc();
                });
            });
        }

        function initializeLoginState() {
            const savedUser = sessionStorage.getItem('golf_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (users.some(u => u.name === currentUser.name && String(u.phone) === String(currentUser.phone))) {
                    showMainApp();
                } else {
                    sessionStorage.removeItem('golf_currentUser');
                    showLoginScreen();
                }
            } else { showLoginScreen(); }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }
        
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            renderApp();
        }

        function renderApp() {
            const isManager = currentUser && currentUser.name === 'ì‹ ì„ì¤‘';
            document.getElementById('anonymousTabBtn').classList.toggle('hidden', !isManager);
            document.getElementById('prepaidTabBtn').classList.toggle('hidden', !isManager);
            document.getElementById('lookupTabBtn').classList.toggle('hidden', !isManager);
            
            // ê´€ë¦¬ì ì „ìš© ë²„íŠ¼ í‘œì‹œ ì„¤ì •
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            const cancelBtn = document.getElementById('cancelSelectedBtn');
            const adminControls = document.getElementById('adminOnlyControls');

            if (isManager) {
                adminControls.classList.remove('hidden');
                deleteBtn.classList.remove('hidden');
                cancelBtn.classList.remove('hidden'); 
            } else {
                adminControls.classList.add('hidden');
                deleteBtn.classList.add('hidden');
                cancelBtn.classList.remove('hidden');
            }

            document.getElementById('calendarNameFilterWrapper').classList.toggle('hidden', !isManager);
            document.getElementById('statusNameFilterWrapper').classList.toggle('hidden', !isManager);
            document.getElementById('statusCourseFilterWrapper').classList.toggle('hidden', !isManager);
            document.getElementById('adminEntertainmentFilter').classList.toggle('hidden', !isManager);

            if (isManager) {
                populateNameOptions();
                populateCourseOptions();
            }

            renderCalendar();
            renderStatus();
            renderEntertainmentView();
            if(isManager) {
                renderAnonymousView();
                renderPrepaidView();
            }
        }

        function populateNameOptions() {
            const nameSet = new Set(users.map(u => u.name));
            bookings.forEach(b => { if(b.Name) nameSet.add(b.Name); });
            const sortedNames = Array.from(nameSet).sort((a, b) => a.localeCompare(b));

            const options = `<option value="ì „ì²´">ì „ì²´</option>` + sortedNames.map(name => `<option value="${name}">${name}</option>`).join('');

            const calSelect = document.getElementById('calendarNameSelect');
            const statSelect = document.getElementById('statusNameSelect');
            const entSelect = document.getElementById('entertainmentNameFilter');

            const currentCalVal = calSelect.value || 'ì „ì²´';
            const currentStatVal = statSelect.value || 'ì „ì²´';
            const currentEntVal = entSelect.value || 'ì „ì²´';

            calSelect.innerHTML = options;
            statSelect.innerHTML = options;
            entSelect.innerHTML = options;
            
            calSelect.value = currentCalVal;
            statSelect.value = currentStatVal;
            entSelect.value = currentEntVal;
        }

        function populateCourseOptions() {
             const select = document.getElementById('statusCourseSelect');
             if (select.options.length > 1) return; 
             
             let html = `<option value="ì „ì²´">ì „ì²´</option>`;
             CALENDAR_GOLF_COURSES.forEach(c => {
                 html += `<option value="${c}">${c}</option>`;
             });
             select.innerHTML = html;
        }

        function showLoading(isLoading, message = "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...") {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            if (isLoading) {
                text.textContent = message;
                overlay.style.display = 'flex';
            } else {
                overlay.style.display = 'none';
            }
        }

        async function fetchInitialData() {
            const response = await fetch(`${SCRIPT_URL}?action=read`);
            const data = await response.json();
            bookings = data.bookings || [];
            users = data.users || [];
            allEntertainmentLogs = data.entertainmentData || [];
            userQuotas = data.quotas.reduce((acc, q) => { acc[q.Name] = q; return acc; }, {});
        }

        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            
            const startMonth = selectedHalf === '1' ? 0 : 6;
            const endMonth = selectedHalf === '1' ? 5 : 11;
            const isManager = currentUser && currentUser.name === 'ì‹ ì„ì¤‘';

            const checkedCourses = Array.from(document.querySelectorAll('input[name="calCourseFilter"]:checked')).map(cb => cb.value);
            
            let filteredBookings = bookings.filter(b => isInSelectedPeriod(b.Date) && VALID_STATUSES.includes(b.Status));

            if (!checkedCourses.includes('ì „ì²´')) {
                filteredBookings = filteredBookings.filter(b => checkedCourses.includes(b['Golf Course']));
            }
            
            if (isManager && calendarNameFilter !== 'ì „ì²´') {
                filteredBookings = filteredBookings.filter(b => b.Name === calendarNameFilter);
            }

            if (calendarMyBookingFilter) {
                filteredBookings = filteredBookings.filter(b => b.Name === currentUser.name);
            }

            const bookingMap = new Map();
            filteredBookings.forEach(b => {
                const normDate = String(b.Date).replace(/\./g, '-').substring(0, 10);
                if (!bookingMap.has(normDate)) bookingMap.set(normDate, []);
                bookingMap.get(normDate).push(b);
            });

            for (let m = startMonth; m <= endMonth; m++) {
                const firstDay = new Date(selectedYear, m, 1);
                const lastDay = new Date(selectedYear, m + 1, 0);
                
                const monthlyBookings = bookings.filter(b => {
                    if (!VALID_STATUSES.includes(b.Status)) return false; 
                    const d = new Date(String(b.Date).replace(/\./g, '-'));
                    return !isNaN(d) && d.getFullYear() === selectedYear && d.getMonth() === m;
                });
                
                const userMonthly = monthlyBookings.filter(b => b.Name === currentUser.name);
                const q = userQuotas[currentUser.name] || {};

                let warnings = [];
                const lakewoodWd = monthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length;
                const lakewoodWe = monthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length;
                if (lakewoodWd >= 9) warnings.push('â€» ë ˆì´í¬ ì£¼ì¤‘ ë§ˆê°');
                if (lakewoodWe >= 6) warnings.push('â€» ë ˆì´í¬ ì£¼ë§ ë§ˆê°');

                const vellutoWd = monthlyBookings.filter(b => b['Golf Course'] === 'ë²¨ë£¨í† ' && !isWeekendBooking(b)).length;
                const vellutoWe = monthlyBookings.filter(b => b['Golf Course'] === 'ë²¨ë£¨í† ' && isWeekendBooking(b)).length;
                if (vellutoWd >= 5) warnings.push('â€» ë²¨ë£¨í†  ì£¼ì¤‘ ë§ˆê°');
                if (vellutoWe >= 3) warnings.push('â€» ë²¨ë£¨í†  ì£¼ë§ ë§ˆê°');

                const monthContainer = document.createElement('div');
                monthContainer.className = 'bg-white p-2 md:p-4 rounded-xl md:rounded-2xl shadow-sm border border-gray-200';
                
                const quotaHtml = `<div class="text-[10px] md:text-xs font-bold text-gray-500 grid grid-cols-2 gap-x-1 md:gap-x-2 mb-1 md:mb-2 gap-y-0.5 md:gap-y-1">
                    <span>ë ˆì´í¬(ì£¼ì¤‘): ${userMonthly.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length}/${q.Lakewood_Weekday||0}</span>
                    <span>ë ˆì´í¬(ì£¼ë§): ${userMonthly.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length}/${q.Lakewood_Weekend||0}</span>
                    <span>ìŠ¤ì¹´ì´ë°¸ë¦¬: ${userMonthly.filter(b => b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬').length}/${q.SkyValley||0}</span>
                    <span>íë“œë¡œì‚¬ì´: ${userMonthly.filter(b => b['Golf Course'] === 'íë“œë¡œì‚¬ì´').length}/${q.HillydeSicy||0}</span>
                    <span>ë²¨ë£¨í† (ì£¼ì¤‘): ${userMonthly.filter(b => b['Golf Course'] === 'ë²¨ë£¨í† ' && !isWeekendBooking(b)).length}/${q.Velluto_Weekday || q.Seragio_Weekday || 0}</span>
                    <span>ë²¨ë£¨í† (ì£¼ë§): ${userMonthly.filter(b => b['Golf Course'] === 'ë²¨ë£¨í† ' && isWeekendBooking(b)).length}/${q.Velluto_Weekend || q.Seragio_Weekend || 0}</span>
                </div>`;

                const warningHtml = warnings.length > 0 
                    ? `<div class="mb-2 md:mb-3 text-[10px] md:text-xs font-bold text-red-600 bg-red-50 p-1 md:p-2 rounded-lg text-center border border-red-100">${warnings.join('<br>')}</div>` 
                    : `<div class="mb-2 md:mb-3 border-b"></div>`;

                monthContainer.innerHTML = `${quotaHtml}${warningHtml}<div class="text-base md:text-xl font-black text-center mb-2 md:mb-4 text-gray-800">${selectedYear}ë…„ ${m + 1}ì›”</div><div class="grid grid-cols-7 gap-1 text-center text-xs md:text-sm font-bold text-gray-400 mb-1 md:mb-2"><div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div></div>`;
                
                const dayGrid = document.createElement('div');
                dayGrid.className = 'grid grid-cols-7 gap-1';
                for (let i = 0; i < firstDay.getDay(); i++) dayGrid.innerHTML += '<div></div>';
                
                for (let d = 1; d <= lastDay.getDate(); d++) {
                    const dateStr = `${selectedYear}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell rounded-lg md:rounded-xl p-1 transition-transform active:scale-95';
                    
                    let bookingHtml = '';
                    if (bookingMap.has(dateStr)) {
                        const dayBookings = bookingMap.get(dateStr);
                        // ì¤‘ë³µ í‘œì‹œ ë°©ì§€ë¥¼ ìœ„í•´ Set ì‚¬ìš©
                        const uniqueCourses = [...new Set(dayBookings.map(b => b['Golf Course']))];
                        
                        // [ìˆ˜ì •] ì •ë ¬ ìˆœì„œ ì ìš© (ë ˆì´í¬ìš°ë“œ > ìŠ¤ì¹´ì´ë°¸ë¦¬ > íë“œë¡œì‚¬ì´ > ë²¨ë£¨í† )
                        uniqueCourses.sort((a, b) => (COURSE_PRIORITY[a] || 99) - (COURSE_PRIORITY[b] || 99));

                        uniqueCourses.forEach(course => {
                            bookingHtml += `<div class="booking-info ${GOLF_COURSE_COLORS[course] || ''} truncate">${COURSE_ABBR[course] || course}</div>`;
                        });
                    }
                    
                    const dayOfWeek = new Date(selectedYear, m, d).getDay();
                    let color = 'text-gray-700';
                    if (dayOfWeek === 0 || holidays[dateStr]) color = 'text-red-600';
                    else if (dayOfWeek === 6) color = 'text-blue-600';

                    dayCell.innerHTML = `<div class="text-sm md:text-lg font-bold ${color} mb-0 md:mb-1">${d}</div>${bookingHtml}`;
                    dayCell.onclick = () => openBookingModal(null, dateStr);
                    dayGrid.appendChild(dayCell);
                }
                monthContainer.appendChild(dayGrid);
                calendarEl.appendChild(monthContainer);
            }
        }

        function renderStatus() {
            const statusTableBody = document.getElementById('statusTableBody');
            statusTableBody.innerHTML = '';
            const isManager = currentUser.name === 'ì‹ ì„ì¤‘';
            
            let filtered = bookings.filter(b => isInSelectedPeriod(b.Date));

            if (!isManager) {
                filtered = filtered.filter(b => b.Name === currentUser.name);
            } else {
                if (statusNameFilter !== 'ì „ì²´') {
                    filtered = filtered.filter(b => b.Name === statusNameFilter);
                }
                if (statusCourseFilter !== 'ì „ì²´') {
                    filtered = filtered.filter(b => b['Golf Course'] === statusCourseFilter);
                }
            }

            const checkedStatuses = Array.from(document.querySelectorAll('input[name="statusFilter"]:checked')).map(cb => cb.value);

            if (!checkedStatuses.includes('ì „ì²´')) {
                filtered = filtered.filter(b => {
                    if (checkedStatuses.includes(b.Status)) return true;
                    if (checkedStatuses.includes('ì·¨ì†Œ') && ['ìš°ì²œì·¨ì†Œ', 'ì·¨ì†Œì™„ë£Œ', 'ì·¨ì†Œì¤‘'].includes(b.Status)) return true;
                    return false;
                });
            }

            if (filtered.length === 0) {
                statusTableBody.innerHTML = `<tr><td colspan="8" class="text-center py-6 md:py-10 text-gray-500 font-bold text-sm md:text-base">ì¡°ê±´ì— ë§ëŠ” ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            filtered.sort((a, b) => {
                let vA = a[sortColumn], vB = b[sortColumn];
                return sortDirection === 'asc' ? String(vA).localeCompare(String(vB)) : String(vB).localeCompare(String(vA));
            }).forEach(b => {
                const displayDate = String(b.Date).replace(/\./g, '-').substring(5, 10);
                
                let rowClass = "border-b hover:bg-blue-50 cursor-pointer transition-colors";
                const status = b.Status || '';
                if (['ìš°ì²œì·¨ì†Œ', 'ì·¨ì†Œì™„ë£Œ', 'ì·¨ì†Œì¤‘'].includes(status)) {
                    rowClass = "border-b hover:bg-red-50 bg-red-50 text-red-900 cursor-pointer transition-colors";
                }

                const row = document.createElement('tr');
                row.className = rowClass;
                row.innerHTML = `<td class="p-2 md:p-4 text-center"><input type="checkbox" class="booking-checkbox w-4 h-4 md:w-5 md:h-5 accent-blue-600" data-id="${b.id}"></td>
                    <td class="p-2 md:p-4 font-bold text-gray-800">${b['Golf Course']}</td>
                    <td class="p-2 md:p-4 font-bold">${b.Name}</td>
                    <td class="p-2 md:p-4 font-bold text-gray-600">${displayDate}</td>
                    <td class="p-2 md:p-4 text-center font-bold">${b.Team}</td>
                    <td class="p-2 md:p-4">${b.Time || '-'}</td>
                    <td class="p-2 md:p-4"><span class="px-2 py-0.5 md:px-3 md:py-1 rounded-full text-xs md:text-sm font-bold bg-white border border-gray-300 shadow-sm whitespace-nowrap">${status || 'ë¯¸ì •'}</span></td>
                    <td class="p-2 md:p-4 text-xs md:text-sm text-gray-500 col-comment" title="${b.Comment || ''}">${b.Comment || ''}</td>`;
                row.onclick = (e) => { if(e.target.type !== 'checkbox') openBookingModal(b); };
                statusTableBody.appendChild(row);
            });
        }

        function renderEntertainmentView() {
            const entertainmentTableBody = document.getElementById('entertainmentTableBody');
            entertainmentTableBody.innerHTML = '';
            const isManager = currentUser.name === 'ì‹ ì„ì¤‘';
            
            let filtered = bookings.filter(b => 
                isInSelectedPeriod(b.Date) && b.MP != 0 &&
                (b.Status === 'ì˜ˆì•½ì™„ë£Œ' || b.Status === 'ìš°ì²œì·¨ì†Œ' || b.Status === 'ì˜ˆì•½ì¤‘' || !b.Status)
            );

            if (isManager) {
                if (entertainmentSelectedName !== 'ì „ì²´') filtered = filtered.filter(b => b.Name === entertainmentSelectedName);
            } else {
                filtered = filtered.filter(b => b.Name === currentUser.name);
            }

            let total = 0;
            filtered.forEach(b => {
                total += parseInt(b.EE) || 0;
                const displayDate = String(b.Date).replace(/\./g, '-');
                const row = document.createElement('tr');
                row.className = "border-b text-xs md:text-sm hover:bg-gray-50";
                row.innerHTML = `<td class="p-2 md:p-4 font-bold">${b['Golf Course']}</td><td class="p-2 md:p-4">${b.Name}</td><td class="p-2 md:p-4">${displayDate}</td><td class="p-2 md:p-4 text-center">${b.Team}</td><td class="p-2 md:p-4">${b.Time||''}</td><td class="p-2 md:p-4">${b.Status||''}</td><td class="p-2 md:p-4 text-right font-black text-blue-700 text-sm md:text-lg">â‚©${(parseInt(b.EE)||0).toLocaleString()}</td>`;
                entertainmentTableBody.appendChild(row);
            });

            document.getElementById('totalEntertainmentCost').textContent = `â‚©${total.toLocaleString()}`;
            loadEntertainmentInputs(isManager ? entertainmentSelectedName : currentUser.name);
        }

        function renderAnonymousView() {
            const container = document.getElementById('anonymousTableContainer');
            container.innerHTML = '';
            
            const cats = ['Lakewood_Weekday', 'Lakewood_Weekend', 'Velluto_Weekday', 'Velluto_Weekend'];
            const catNames = { 
                'Lakewood_Weekday': 'ë ˆì´í¬ ì£¼ì¤‘', 'Lakewood_Weekend': 'ë ˆì´í¬ ì£¼ë§', 
                'Velluto_Weekday': 'ë²¨ë£¨í†  ì£¼ì¤‘', 'Velluto_Weekend': 'ë²¨ë£¨í†  ì£¼ë§' 
            };
            
            const startM = selectedHalf === '1' ? 1 : 7;
            const endM = selectedHalf === '1' ? 6 : 12;

            const userNames = [...new Set(bookings.filter(b => isInSelectedPeriod(b.Date)).map(b => b.Name))].sort();
            
            let html = `<table class="grid-view-table w-full border-collapse"><thead><tr class="bg-gray-50">
                <th rowspan="2" class="p-2 md:p-3 border font-bold text-xs md:text-base">ì„±ëª…</th>`;
            cats.forEach(c => html += `<th colspan="6" class="p-1 md:p-2 border text-xs md:text-sm font-bold bg-blue-50 text-blue-800">${catNames[c]}</th>`);
            html += `</tr><tr>`;
            cats.forEach(() => { for(let i=startM; i<=endM; i++) html += `<th class="p-1 md:p-2 border text-[10px] md:text-xs text-gray-500">${i}ì›”</th>`; });
            html += `</tr></thead><tbody>`;

            userNames.forEach(name => {
                html += `<tr><td class="p-2 md:p-3 border font-bold bg-gray-50 text-xs md:text-base">${name}</td>`;
                cats.forEach(cat => {
                    for(let m=startM; m<=endM; m++) {
                        const days = bookings.filter(b => b.Name === name && IS_VALID_FOR_COUNTING(b))
                            .filter(b => {
                                const d = new Date(String(b.Date).replace(/\./g, '-'));
                                if(isNaN(d)) return false;
                                const isTargetMonth = (d.getMonth() + 1) === m && d.getFullYear() === selectedYear;
                                if(!isTargetMonth) return false;

                                const isW = isWeekendBooking(b);
                                if(cat.startsWith('Lakewood')) return b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && (cat.endsWith('Weekend') ? isW : !isW);
                                if(cat.startsWith('Velluto')) return b['Golf Course'] === 'ë²¨ë£¨í† ' && (cat.endsWith('Weekend') ? isW : !isW);
                                return false;
                            }).map(b => new Date(String(b.Date).replace(/\./g, '-')).getDate()).join(',');
                        html += `<td class="p-1 md:p-2 border text-xs md:text-sm font-bold text-center text-blue-700">${days}</td>`;
                    }
                });
                html += `</tr>`;
            });
            container.innerHTML = html + `</tbody></table>`;
        }

        function renderPrepaidView() {
            const container = document.getElementById('prepaidTableContainer');
            container.innerHTML = '';
            
            const courses = ['ìŠ¤ì¹´ì´ë°¸ë¦¬', 'íë“œë¡œì‚¬ì´'];
            const startM = selectedHalf === '1' ? 1 : 7;
            const endM = selectedHalf === '1' ? 6 : 12;

            const userNames = [...new Set(bookings.filter(b => isInSelectedPeriod(b.Date)).map(b => b.Name))].sort();
            
            let html = `<table class="grid-view-table w-full border-collapse"><thead><tr class="bg-gray-50">
                <th rowspan="2" class="p-2 md:p-3 border font-bold text-xs md:text-base">ì„±ëª…</th>`;
            courses.forEach(c => html += `<th colspan="6" class="p-1 md:p-2 border text-xs md:text-sm font-bold bg-indigo-50 text-indigo-800">${c}</th>`);
            html += `</tr><tr>`;
            courses.forEach(() => { for(let i=startM; i<=endM; i++) html += `<th class="p-1 md:p-2 border text-[10px] md:text-xs text-gray-500">${i}ì›”</th>`; });
            html += `</tr></thead><tbody>`;

            userNames.forEach(name => {
                html += `<tr><td class="p-2 md:p-3 border font-bold bg-gray-50 text-xs md:text-base">${name}</td>`;
                courses.forEach(course => {
                    for(let m=startM; m<=endM; m++) {
                        const days = bookings.filter(b => b.Name === name && IS_VALID_FOR_COUNTING(b))
                            .filter(b => {
                                const d = new Date(String(b.Date).replace(/\./g, '-'));
                                if(isNaN(d)) return false;
                                const isTargetMonth = (d.getMonth() + 1) === m && d.getFullYear() === selectedYear;
                                if(!isTargetMonth) return false;
                                return b['Golf Course'] === course;
                            }).map(b => new Date(String(b.Date).replace(/\./g, '-')).getDate()).join(',');
                        html += `<td class="p-1 md:p-2 border text-xs md:text-sm font-bold text-center text-blue-700">${days}</td>`;
                    }
                });
                html += `</tr>`;
            });
            container.innerHTML = html + `</tbody></table>`;
        }

        function setupEventListeners() {
            const btns = ['calendarTabBtn', 'statusTabBtn', 'entertainmentTabBtn', 'lookupTabBtn', 'anonymousTabBtn', 'prepaidTabBtn'];
            btns.forEach(id => {
                document.getElementById(id)?.addEventListener('click', () => {
                    btns.forEach(b => {
                        const el = document.getElementById(b);
                        el.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                        el.classList.add('bg-white', 'text-gray-600', 'border');
                        document.getElementById(b.replace('TabBtn', 'View')).classList.add('hidden');
                    });
                    const target = document.getElementById(id);
                    target.classList.remove('bg-white', 'text-gray-600', 'border');
                    target.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                    document.getElementById(id.replace('TabBtn', 'View')).classList.remove('hidden');
                });
            });
            
            document.getElementById('logoutBtn').onclick = () => {
                sessionStorage.removeItem('golf_currentUser');
                location.reload();
            };
            
            document.getElementById('noticeLink').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('noticeModal').style.display = 'flex';
            });
            
            document.getElementById('closeNoticeBtn').addEventListener('click', () => {
                document.getElementById('noticeModal').style.display = 'none';
            });

            document.getElementById('closeAlertBtn').addEventListener('click', () => {
                document.getElementById('alertModal').style.display = 'none';
            });

            document.getElementById('confirmOkBtn').onclick = () => {
                document.getElementById('confirmModal').style.display = 'none';
                if(confirmCallback) confirmCallback();
            };
            document.getElementById('confirmCancelBtn').onclick = () => {
                document.getElementById('confirmModal').style.display = 'none';
            };
            
            document.getElementById('openModalBtn').onclick = () => openBookingModal();
            document.getElementById('closeModalBtn').onclick = () => document.getElementById('bookingModal').style.display='none';
            
            document.getElementById('loginForm').onsubmit = (e) => {
                e.preventDefault();
                const u = document.getElementById('loginUsername').value;
                const p = document.getElementById('loginPassword').value;
                const found = users.find(user => user.name === u && String(user.phone) === p);
                
                if(found) {
                    const now = new Date();
                    const openDateVIP = new Date('2026-01-13T00:00:00');
                    const openDateGeneral = new Date('2026-01-19T00:00:00');
                    
                    if (found.name !== 'ì‹ ì„ì¤‘') {
                        const isVIP = String(p).toLowerCase().startsWith('iw');
                        if (isVIP) {
                            if (now < openDateVIP) {
                                showAlert("ì˜¤í”ˆ ì˜ˆì •ì…ë‹ˆë‹¤. (2026ë…„ 1ì›” 13ì¼ 00ì‹œ ì˜¤í”ˆ)");
                                return;
                            }
                        } else {
                            if (now < openDateGeneral) {
                                showAlert("ì˜¤í”ˆ ì˜ˆì •ì…ë‹ˆë‹¤. (2026ë…„ 1ì›” 19ì¼ 00ì‹œ ì˜¤í”ˆ)");
                                return;
                            }
                        }
                    }
                    
                    currentUser = found;
                    sessionStorage.setItem('golf_currentUser', JSON.stringify(found));
                    showMainApp(); 
                } else showAlert("ë¡œê·¸ì¸ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            };

            document.getElementById('lookupBtn').onclick = () => {
                const name = document.getElementById('lookupName').value;
                const results = document.getElementById('lookupResults');
                if (!name) return showAlert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
                
                const q = userQuotas[name];
                if (!q) return results.innerHTML = `<p class="text-red-600 font-bold p-4">âš ï¸ í•´ë‹¹ ì‚¬ìš©ìì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;

                const periodBookings = bookings.filter(b => b.Name === name && isInSelectedPeriod(b.Date) && IS_VALID_FOR_COUNTING(b));

                let html = `<div class="p-4 md:p-6 bg-white border border-gray-200 rounded-xl md:rounded-2xl shadow-sm"><h3 class="font-black text-xl md:text-2xl mb-4 md:mb-6 text-gray-800 border-b pb-2 md:pb-4">${name}ë‹˜ ${selectedYear}ë…„ ${selectedHalf==='1'?'ìƒë°˜ê¸°':'í•˜ë°˜ê¸°'} ì´ìš© í˜„í™©</h3>`;
                html += `<table class="w-full text-sm md:text-base border-collapse"><thead><tr class="bg-gray-100 text-gray-700"><th class="p-2 md:p-3 border">í•­ëª©</th><th class="p-2 md:p-3 border">í•œë„(6ê°œì›”)</th><th class="p-2 md:p-3 border">ì‚¬ìš©</th><th class="p-2 md:p-3 border">ì”ì—¬</th></tr></thead><tbody>`;
                
                const items = [
                    {k: 'ë ˆì´í¬ ì£¼ì¤‘', val: q.Lakewood_Weekday, used: periodBookings.filter(b => b['Golf Course']==='ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length},
                    {k: 'ë ˆì´í¬ ì£¼ë§', val: q.Lakewood_Weekend, used: periodBookings.filter(b => b['Golf Course']==='ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length},
                    {k: 'ìŠ¤ì¹´ì´ë°¸ë¦¬', val: q.SkyValley, used: periodBookings.filter(b => b['Golf Course']==='ìŠ¤ì¹´ì´ë°¸ë¦¬').length},
                    {k: 'íë“œë¡œì‚¬ì´', val: q.HillydeSicy, used: periodBookings.filter(b => b['Golf Course']==='íë“œë¡œì‚¬ì´').length},
                    {k: 'ë²¨ë£¨í†  ì£¼ì¤‘', val: q.Velluto_Weekday || q.Seragio_Weekday, used: periodBookings.filter(b => b['Golf Course']==='ë²¨ë£¨í† ' && !isWeekendBooking(b)).length},
                    {k: 'ë²¨ë£¨í†  ì£¼ë§', val: q.Velluto_Weekend || q.Seragio_Weekend, used: periodBookings.filter(b => b['Golf Course']==='ë²¨ë£¨í† ' && isWeekendBooking(b)).length}
                ];

                items.forEach(i => {
                    const totalLimit = (i.val || 0) * 6;
                    const remaining = totalLimit - i.used;
                    html += `<tr class="border-b hover:bg-gray-50 text-center"><td class="p-2 md:p-3 font-bold text-gray-700 text-left">${i.k}</td><td class="p-2 md:p-3 text-gray-600">${totalLimit}</td><td class="p-2 md:p-3 text-blue-600 font-bold">${i.used}</td><td class="p-2 md:p-3 font-black text-base md:text-lg ${remaining < 0 ? 'text-red-500' : 'text-green-600'}">${remaining}</td></tr>`;
                });
                results.innerHTML = html + `</tbody></table></div>`;
            };

            document.getElementById('calendarNameSelect').addEventListener('change', (e) => {
                calendarNameFilter = e.target.value;
                renderCalendar();
            });

            document.getElementById('statusNameSelect').addEventListener('change', (e) => {
                statusNameFilter = e.target.value;
                renderStatus();
            });

            document.getElementById('statusCourseSelect').addEventListener('change', (e) => {
                statusCourseFilter = e.target.value;
                renderStatus();
            });

            document.getElementById('entertainmentNameFilter').addEventListener('change', (e) => {
                entertainmentSelectedName = e.target.value;
                renderEntertainmentView();
            });

            document.addEventListener('change', function(e) {
                if(e.target && e.target.id === 'selectAllStatus') {
                    const isChecked = e.target.checked;
                    document.querySelectorAll('.booking-checkbox').forEach(cb => cb.checked = isChecked);
                }
            });

            document.getElementById('cancelSelectedBtn').addEventListener('click', async () => {
                const checkedBoxes = document.querySelectorAll('.booking-checkbox:checked');
                if (checkedBoxes.length === 0) {
                    showAlert("ì·¨ì†Œí•  ë‚´ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                showConfirm(`ì„ íƒí•œ ${checkedBoxes.length}ê±´ì˜ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nìƒíƒœê°€ 'ì·¨ì†Œì¤‘'ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.`, async () => {
                    showLoading(true, "ì„ íƒí•œ ì˜ˆì•½ì„ ì·¨ì†Œ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...");

                    try {
                        const updatePromises = Array.from(checkedBoxes).map(cb => {
                            const id = cb.getAttribute('data-id');
                            const originalBooking = bookings.find(b => String(b.id) === String(id));
                            if (!originalBooking) return null;
                            const updatedBooking = { ...originalBooking, Status: 'ì·¨ì†Œì¤‘' };
                            return postData('update', { user: currentUser.name, booking: updatedBooking }, true);
                        }).filter(p => p !== null);

                        await Promise.all(updatePromises);
                        showAlert("ì„ íƒí•œ ì˜ˆì•½ì´ ì¼ê´„ ì·¨ì†Œ(ìƒíƒœ ë³€ê²½) ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        await fetchInitialData();
                        renderApp();
                    } catch (error) {
                        console.error(error);
                        showAlert("ì¼ê´„ ì²˜ë¦¬ ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        await fetchInitialData(); 
                        renderApp();
                    } finally {
                        showLoading(false);
                    }
                });
            });

            document.getElementById('deleteSelectedBtn').addEventListener('click', async () => {
                const checkedBoxes = document.querySelectorAll('.booking-checkbox:checked');
                if (checkedBoxes.length === 0) {
                    showAlert("ì‚­ì œí•  ë‚´ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                showConfirm(`ì„ íƒí•œ ${checkedBoxes.length}ê±´ì˜ ì˜ˆì•½ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, async () => {
                    showLoading(true, "ì„ íƒí•œ ì˜ˆì•½ì„ ì‚­ì œ ì¤‘ì…ë‹ˆë‹¤...");

                    try {
                        const deletePromises = Array.from(checkedBoxes).map(cb => {
                            const id = cb.getAttribute('data-id');
                            const originalBooking = bookings.find(b => String(b.id) === String(id));
                            if (!originalBooking) return null;
                            return postData('delete', { user: currentUser.name, booking: originalBooking }, true);
                        }).filter(p => p !== null);

                        await Promise.all(deletePromises);
                        showAlert("ì„ íƒí•œ ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        await fetchInitialData();
                        renderApp();
                    } catch (error) {
                        console.error(error);
                        showAlert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        await fetchInitialData();
                        renderApp();
                    } finally {
                        showLoading(false);
                    }
                });
            });
        }

        function openBookingModal(booking = null, dateStr = null) {
            const modal = document.getElementById('bookingModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('bookingForm');
            
            updateAvailableGolfCourses(dateStr || new Date().toISOString().split('T')[0]);

            if (booking) {
                title.textContent = "ì˜ˆì•½ ìˆ˜ì •";
                document.getElementById('bookingId').value = booking.id;
                document.getElementById('userName').value = booking.Name;
                document.getElementById('bookingDate').value = String(booking.Date).replace(/\./g, '-');
                document.getElementById('golfCourse').value = booking['Golf Course'];
                document.getElementById('numberOfTeams').value = booking.Team;
                document.getElementById('bookingTime').value = booking.Time || '';
                document.getElementById('bookingStatus').value = booking.Status || 'ì˜ˆì•½ì¤‘';
                document.getElementById('notes').value = booking.Comment || '';
                
                updateAvailableGolfCourses(String(booking.Date).replace(/\./g, '-'), booking.id);
                document.getElementById('golfCourse').value = booking['Golf Course'];

            } else {
                title.textContent = "ì˜ˆì•½ ì‹ ì²­";
                form.reset();
                document.getElementById('bookingId').value = '';
                document.getElementById('userName').value = currentUser ? currentUser.name : '';
                document.getElementById('bookingStatus').value = 'ì˜ˆì•½ì¤‘';
                
                if (dateStr) {
                    document.getElementById('bookingDate').value = dateStr;
                    updateAvailableGolfCourses(dateStr);
                }
            }
            modal.style.display = 'flex';
        }

        function updateAvailableGolfCourses(date, excludeBookingId = null) {
            const s = document.getElementById('golfCourse');
            const targetDate = String(date).replace(/\./g, '-').substring(0, 10);

            // [ìˆ˜ì •] í•´ë‹¹ ë‚ ì§œì— *ëˆ„êµ¬ë¼ë„* ìœ íš¨í•œ ì˜ˆì•½ì„ í•œ ê³¨í”„ì¥ì€ ëª©ë¡ì—ì„œ ì œì™¸ (ì¤‘ë³µ ë°©ì§€)
            const bookedCourses = bookings.filter(b => {
                // ìˆ˜ì • ì‹œ ìê¸° ìì‹ ì˜ ì˜ˆì•½ì€ ì œì™¸í•˜ê³  ì²´í¬
                if (excludeBookingId && String(b.id) === String(excludeBookingId)) return false;
                
                const bDate = String(b.Date).replace(/\./g, '-').substring(0, 10);
                const isActive = !['ì·¨ì†Œì™„ë£Œ', 'ìš°ì²œì·¨ì†Œ', 'ì·¨ì†Œì¤‘'].includes(b.Status);
                
                // ê¸°ì¡´: b.Name === currentUser.name ì¡°ê±´ì´ ìˆì—ˆìœ¼ë‚˜ ì œê±°í•˜ì—¬ 'ëª¨ë“  ì‚¬ëŒ'ì˜ ì˜ˆì•½ì„ ì²´í¬
                return bDate === targetDate && isActive;
            }).map(b => b['Golf Course']);

            const availableCourses = MODAL_GOLF_COURSES.filter(c => !bookedCourses.includes(c));

            if (availableCourses.length === 0) {
                s.innerHTML = '<option value="">ì˜ˆì•½ ê°€ëŠ¥í•œ ê³¨í”„ì¥ì´ ì—†ìŠµë‹ˆë‹¤</option>';
            } else {
                s.innerHTML = availableCourses.map(c => `<option value="${c}">${c}</option>`).join('');
            }
        }
        function loadEntertainmentInputs(name) { }
        
        async function postData(action, data, silent = false) {
            let msg = "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...";
            if(action === 'add' || action === 'update') msg = "ì˜ˆì•½ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...";
            else if(action === 'saveEntertainment') msg = "ì ‘ëŒ€ë¹„ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...";
            else if(action === 'cancel') msg = "ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  ìˆìŠµë‹ˆë‹¤...";
            else if(action === 'delete') msg = "ì˜ˆì•½ì„ ì‚­ì œí•˜ê³  ìˆìŠµë‹ˆë‹¤...";

            if (!silent) showLoading(true, msg);
            try {
                const response = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action, ...data }) });
                const result = await response.json();
                if (result.status !== 'success') throw new Error(result.message);
                
                if (!silent) {
                    showAlert(result.message);
                    document.getElementById('bookingModal').style.display = 'none';
                    await fetchInitialData();
                    renderApp();
                }
                return result;
            } catch (error) {
                if (!silent) showAlert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                throw error;
            } finally {
                if (!silent) showLoading(false);
            }
        }

        // [ì‹ ê·œ] ì›”ë³„ ì¿¼í„° ì œí•œ ì²´í¬ í•¨ìˆ˜
        function checkQuota(bookingData) {
            const course = bookingData['Golf Course'];
            const dateStr = bookingData['Date'];
            const targetDate = new Date(dateStr);
            const targetMonth = targetDate.getMonth(); // 0-11
            const targetYear = targetDate.getFullYear();
            
            // ìš”ì¼ ì²´í¬ (0:ì¼, 6:í†  -> ì£¼ë§)
            // ê³µíœ´ì¼ ì²´í¬ ë¡œì§ì´ holidays ê°ì²´ì— ìˆìœ¼ë¯€ë¡œ í™œìš©
            // ê¸°ì¡´ isWeekendBooking í•¨ìˆ˜ëŠ” ì˜ˆì•½ ê°ì²´(b)ë¥¼ ë°›ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë‚ ì§œë¡œ íŒë‹¨í•´ì•¼ í•¨
            const dayOfWeek = targetDate.getDay();
            const dateKey = dateStr.substring(0, 10);
            const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6 || holidays[dateKey]);

            const q = userQuotas[currentUser.name] || {};
            let limit = 0;
            let currentUsage = 0;

            // ê³¨í”„ì¥ë³„ ì¿¼í„° í‚¤ ë§¤í•‘ ë° ì‚¬ìš©ëŸ‰ ê³„ì‚°
            if (course === 'ë ˆì´í¬ìš°ë“œ') {
                limit = isWeekend ? (q.Lakewood_Weekend || 0) : (q.Lakewood_Weekday || 0);
                // í•´ë‹¹ ì›”, í•´ë‹¹ ì½”ìŠ¤, í•´ë‹¹ ìš”ì¼(ì£¼ë§/ì£¼ì¤‘) ì˜ˆì•½ ì¹´ìš´íŠ¸
                currentUsage = bookings.filter(b => {
                    if (b.Name !== currentUser.name) return false;
                    if (!VALID_STATUSES.includes(b.Status)) return false;
                    
                    const bDate = new Date(String(b.Date).replace(/\./g, '-'));
                    if (isNaN(bDate)) return false;
                    
                    // ê°™ì€ ë…„/ì›”ì¸ì§€ í™•ì¸
                    if (bDate.getFullYear() !== targetYear || bDate.getMonth() !== targetMonth) return false;
                    if (b['Golf Course'] !== 'ë ˆì´í¬ìš°ë“œ') return false;

                    // ì£¼ë§ ì—¬ë¶€ í™•ì¸ (ê¸°ì¡´ ë°ì´í„°ì˜ WE í•„ë“œ í™œìš©í•˜ê±°ë‚˜ ë‚ ì§œ ê³„ì‚°)
                    // ë°ì´í„° ì¼ê´€ì„±ì„ ìœ„í•´ ë‚ ì§œ ê³„ì‚°ìœ¼ë¡œ í†µì¼
                    const bDay = bDate.getDay();
                    const bDateKey = String(b.Date).replace(/\./g, '-').substring(0, 10);
                    const bIsWeekend = (bDay === 0 || bDay === 6 || holidays[bDateKey]);
                    
                    return isWeekend === bIsWeekend;
                }).length;
            } else if (course === 'ë²¨ë£¨í† ') {
                limit = isWeekend ? (q.Velluto_Weekend || q.Seragio_Weekend || 0) : (q.Velluto_Weekday || q.Seragio_Weekday || 0);
                currentUsage = bookings.filter(b => {
                    if (b.Name !== currentUser.name) return false;
                    if (!VALID_STATUSES.includes(b.Status)) return false;
                    
                    const bDate = new Date(String(b.Date).replace(/\./g, '-'));
                    if (bDate.getFullYear() !== targetYear || bDate.getMonth() !== targetMonth) return false;
                    if (b['Golf Course'] !== 'ë²¨ë£¨í† ') return false;

                    const bDay = bDate.getDay();
                    const bDateKey = String(b.Date).replace(/\./g, '-').substring(0, 10);
                    const bIsWeekend = (bDay === 0 || bDay === 6 || holidays[bDateKey]);
                    
                    return isWeekend === bIsWeekend;
                }).length;
            } else if (course === 'ìŠ¤ì¹´ì´ë°¸ë¦¬') {
                limit = q.SkyValley || 0;
                currentUsage = bookings.filter(b => {
                     if (b.Name !== currentUser.name) return false;
                     if (!VALID_STATUSES.includes(b.Status)) return false;
                     const bDate = new Date(String(b.Date).replace(/\./g, '-'));
                     if (bDate.getFullYear() !== targetYear || bDate.getMonth() !== targetMonth) return false;
                     return b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬';
                }).length;
            } else if (course === 'íë“œë¡œì‚¬ì´') {
                limit = q.HillydeSicy || 0;
                 currentUsage = bookings.filter(b => {
                     if (b.Name !== currentUser.name) return false;
                     if (!VALID_STATUSES.includes(b.Status)) return false;
                     const bDate = new Date(String(b.Date).replace(/\./g, '-'));
                     if (bDate.getFullYear() !== targetYear || bDate.getMonth() !== targetMonth) return false;
                     return b['Golf Course'] === 'íë“œë¡œì‚¬ì´';
                }).length;
            }

            // ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš°, ìê¸° ìì‹ ì˜ ì˜ˆì•½ì€ ì¹´ìš´íŠ¸ì—ì„œ ì œì™¸í•´ì•¼ í•¨ (ì´ë¯¸ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ)
            // í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” 'ì¶”ê°€' ì‹œ ì²´í¬í•˜ëŠ” ê²ƒì´ë¯€ë¡œ, ìˆ˜ì • ì‹œì—ëŠ” ë‚ ì§œ/ì½”ìŠ¤ê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ì²´í¬ ë¶ˆí•„ìš”, 
            // ë³€ê²½ë˜ë©´ ì²´í¬ í•„ìš”. ë¡œì§ ë³µì¡ì„±ì„ ì¤„ì´ê¸° ìœ„í•´
            // 'ì‹ ê·œ ì˜ˆì•½(id ì—†ìŒ)'ì¼ ë•Œë§Œ ì—„ê²©í•˜ê²Œ ì²´í¬í•˜ê±°ë‚˜, 
            // í˜„ì¬ ì¹´ìš´íŠ¸ì— í¬í•¨ëœ 'ë‚´ ì˜ˆì•½'ì´ ìˆë‹¤ë©´ -1ì„ í•´ì£¼ëŠ” ë¡œì§ì´ í•„ìš”í•¨.
            // ì¼ë‹¨ ì‹ ê·œ ì˜ˆì•½(add) ì‹œì—ë§Œ ì²´í¬í•˜ë„ë¡ ì ìš© (update ì‹œì—ëŠ” ë³´í†µ ë‚ ì§œ ë³€ê²½ì´ ë“œë¬¼ê±°ë‚˜ ê´€ë¦¬ìê°€ í•˜ë¯€ë¡œ)
            
            if (currentUsage >= limit) {
                return `[${course}] ${targetMonth + 1}ì›” ì˜ˆì•½ í•œë„(${limit}íšŒ)ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.`;
            }
            return null; // í†µê³¼
        }
        
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const dateVal = document.getElementById('bookingDate').value;
            const inputName = document.getElementById('userName').value;

            if(dateVal >= '2026-07-01') {
                showAlert("í•˜ë°˜ê¸° ì˜ˆì•½ì€ ì•„ì§ ì˜¤í”ˆë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            const bookingData = {
                'id': document.getElementById('bookingId').value, 'Golf Course': document.getElementById('golfCourse').value,
                'Name': inputName, 'Date': dateVal,
                'Team': document.getElementById('numberOfTeams').value, 'Time': document.getElementById('bookingTime').value,
                'Status': document.getElementById('bookingStatus').value, 'Comment': document.getElementById('notes').value
            };
            
            if (!bookingData.id) {
                // 1. ì¤‘ë³µ ì˜ˆì•½ ì²´í¬
                const isDuplicate = bookings.some(b => {
                    const bDate = String(b.Date).replace(/\./g, '-').substring(0, 10);
                    const isActive = !['ì·¨ì†Œì™„ë£Œ', 'ìš°ì²œì·¨ì†Œ', 'ì·¨ì†Œì¤‘'].includes(b.Status);
                    // ë‹¤ë¥¸ ì‚¬ëŒì´ ì˜ˆì•½í–ˆë”ë¼ë„ í•´ë‹¹ ë‚ ì§œ/ê³¨í”„ì¥ì€ ì´ë¯¸ updateAvailableGolfCoursesì—ì„œ ê±¸ëŸ¬ì§.
                    // ì—¬ê¸°ì„œëŠ” 'ë‚´ê°€' 'ê°™ì€ ë‚ 'ì— 'ë‹¤ë¥¸ ê³¨í”„ì¥'ì´ë¼ë„ ì¤‘ë³µí•´ì„œ ì¡ëŠ” ê²ƒì„ ë§‰ì„ì§€, 
                    // ì•„ë‹ˆë©´ 'ê°™ì€ ê³¨í”„ì¥' ì¤‘ë³µë§Œ ë§‰ì„ì§€ ê²°ì •.
                    // ê¸°íš ì˜ë„ìƒ "ê°™ì€ ë‚  ì¤‘ë³µ ì˜ˆì•½ ë¶ˆê°€"ë¼ë©´ ì•„ë˜ ìœ ì§€.
                    return b.Name === inputName && bDate === dateVal && isActive;
                });

                if (isDuplicate) {
                    showAlert("ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì— ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤.");
                    return;
                }

                // 2. [ì‹ ê·œ] ì¿¼í„° ì œí•œ ì²´í¬ (ê´€ë¦¬ìê°€ ëŒ€ë¦¬ ì˜ˆì•½í•˜ëŠ” ê²½ìš° ì œì™¸í•  ìˆ˜ë„ ìˆìœ¼ë‚˜, ì¼ë‹¨ ëª¨ë‘ ì ìš©)
                if (currentUser.name === inputName) { // ë³¸ì¸ ì˜ˆì•½ì¼ ë•Œë§Œ ì²´í¬ (ê´€ë¦¬ìê°€ íƒ€ì¸ ì˜ˆì•½ì‹œ íŒ¨ìŠ¤ ê°€ëŠ¥)
                     const quotaError = checkQuota(bookingData);
                     if (quotaError) {
                         showAlert(quotaError);
                         return;
                     }
                }
                
                await postData('add', { user: currentUser.name, booking: bookingData });
            } else {
                await postData('update', { user: currentUser.name, booking: bookingData });
            }
        });
        
        function formatNumberWithCommas(value) { return String(value).replace(/[^0-9]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ','); }
        function removeCommas(value) { return String(value).replace(/,/g, ''); }
    </script>
</body>
</html>
